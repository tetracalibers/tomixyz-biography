---
import type { CollectionEntry } from "astro:content"
import { SITE, USE_POST_IMG_OVERLAY, USE_AUTHOR_CARD, USE_SUBSCRIPTION } from "$/config"
import MainLayout from "$/components/MainLayout.astro"
import BaseHead from "$/components/BaseHead.astro"
import Prose from "$/components/Prose.astro"
import ArticleTitle from "$/components/text/ArticleTitle.astro"
import { Icon } from "astro-icon"
import { Image } from "astro:assets"
import AvatarImage from "$components/image-wrapper/AvatarImage.astro"
import TagList from "$/components/article-header/TagList.astro"

interface Props {
  content: CollectionEntry<"project">["data"]
  ogimage?: string
  lang?: string
}
const { content, ogimage, lang = "ja" } = Astro.props

const AUTHOR_NAME = SITE.author
const AUTHOR_TWITTER = SITE.authorTwitter
---

<!doctype html>
<html lang={lang}>
  <head>
    <BaseHead {...content} image={ogimage} title={content.title ? `${SITE.title} | ${content.title}` : SITE.title} />
  </head>
  <MainLayout>
    <div class="flex flex-wrap gap-8 px-4">
      <div class="post__header flex flex-col justify-evenly grow gap-8">
        <div class="h-fit grid gap-8">
          <TagList tags={content.tags} />
          <ArticleTitle title={content.title} />
          <div>
            <p class="text-slate-500 dark:text-theme-dark-secondary text-lg indent-2 text-left">
              {content.description}
            </p>
          </div>
        </div>
        <div class="post__desc flex h-fit gap-2">
          <div class="flex flex-col border-l-2 pl-2 w-full">
            <div class="flex gap-1">
              {
                content.url && (
                  <a class="project__link" href={content.url}>
                    <Icon name="line-md/external-link-rounded" size="30" />
                    Visit Site
                  </a>
                )
              }
              {
                content.github && (
                  <a class="project__link" href={content.github}>
                    <Icon name="lucide:github" size="30" />
                    GitHub
                  </a>
                )
              }
            </div>
            <span class="post__date">
              {new Intl.DateTimeFormat("en-US", { dateStyle: "full" }).format(new Date(content.date))}
            </span>
          </div>
        </div>
      </div>
      <div class="grow-[9999] basis-96 flex items-center">
        {
          content.image ? (
            USE_POST_IMG_OVERLAY ? (
              <>
                <div class="img__outer w-full">
                  <Image src={content.image} alt={content.title} />
                  <div class="img_gradient" />
                </div>
                <br />
              </>
            ) : (
              <>
                <Image class="img__outer w-full" src={content.image} alt={content.title} />
                <br />
              </>
            )
          ) : (
            ""
          )
        }
      </div>
    </div>
    <Prose>
      <slot />
    </Prose>
    <div class="post__footer">
      {
        USE_AUTHOR_CARD && (
          <div class="author-card">
            <AvatarImage className="author-card__img avatar avatar--lg" />
            <div class="author-card__meta">
              {AUTHOR_TWITTER ? (
                <a
                  class="author-card__author"
                  href={`https://twitter.com/${AUTHOR_TWITTER}`}
                  title={`${AUTHOR_NAME}'s twitter`}
                  target="_blank"
                  rel="external"
                >
                  {AUTHOR_NAME}
                </a>
              ) : (
                <span class="author-card__author">{AUTHOR_NAME}</span>
              )}
              <p class="author-card__bio">{SITE.authorBio}</p>
              <br />
              {USE_SUBSCRIPTION ? (
                <form action="" class="subscription-form">
                  <label for="email" />
                  <input
                    type="email"
                    name="email"
                    class="flex-grow border-0 text-theme-accent-gray-dark"
                    required="true"
                  />
                  <button type="submit">Subscribe</button>
                </form>
              ) : (
                <a
                  class="author-card__follow-btn button"
                  target="_blank"
                  href={`https://twitter.com/intent/follow?screen_name=${AUTHOR_TWITTER}`}
                >
                  Follow on Twitter
                </a>
              )}
            </div>
          </div>
        )
      }
    </div>
  </MainLayout>
  <style>
    .post__header {
      @apply py-4 mb-1 text-center md:text-left;
    }
    .post__footer {
      @apply my-6;
    }
    .post__desc {
      @apply text-slate-400 dark:text-theme-dark-secondary flex justify-center text-left md:flex-none md:justify-start;
    }
    .post__author {
      @apply no-underline dark:text-white hover:text-theme-primary;
    }
    .post__date {
      @apply text-slate-500 dark:text-theme-dark-secondary;
    }
    .avatar {
      @apply w-12 h-12 rounded-full object-cover p-1 border-2 border-solid border-theme-dark-primary dark:border-theme-primary;
    }
    .avatar--lg {
      @apply w-32 h-32;
    }

    .img__outer {
      @apply relative rounded-lg drop-shadow-xl overflow-hidden;
    }
    .img_gradient {
      @apply absolute z-10 w-full bottom-0 left-0 h-full bg-gradient-to-tr from-theme-primary dark:from-theme-dark-primary;
    }

    .author-card {
      @apply text-gray-500 dark:text-gray-100 flex flex-row gap-4 justify-start text-left;
    }
    .author-card__meta {
      @apply border-l pl-4;
    }
    .author-card__author {
      @apply text-2xl mb-1;
    }
    .author-card__bio {
      @apply text-gray-400;
    }

    .subscription-form {
      @apply w-4/6 mt-2 flex flex-row rounded-lg overflow-hidden shadow-lg;
    }
    .subscription-form input {
      @apply flex-grow border-0 text-theme-accent-gray-dark;
    }
    .subscription-form button,
    .button {
      @apply px-4 py-2 uppercase font-bold text-white bg-gradient-to-tr from-theme-primary to-theme-dark-secondary dark:from-theme-dark-secondary dark:to-theme-primary;
    }
    .author-card__follow-btn {
      @apply rounded-md shadow-md shadow-theme-dark-secondary dark:shadow-theme-primary hover:shadow-theme-secondary hover:dark:shadow-theme-secondary hover:shadow-lg transition-all;
      display: flex;
      text-align: center;
    }
    .project__link {
      display: flex;
      font-weight: bold;
    }
  </style>
</html>
