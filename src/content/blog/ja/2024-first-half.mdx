---
title: 2024年の冬、春、夏
date: "2024-08-01"
category: tech
description: 寄り道多めの2024年上半期に見つけた興味の記録
---

import { LinkPreview } from "astro-embed"

2024年前半が終わってから一ヶ月が経ってしまっているが、8月に入ってようやく今後何をやるか検討したい段階に来たので…このタイミングで振り返ってみる。

## 一ヶ月サイクルで興味は切り替わる

2024年前半はとにかく寄り道多めで過ごしていた。

- 1月にRustを書き始め、
- 2月はなぜかExcel関数の教材を作り、
- 3月はネットワークを真剣に勉強、
- 4月はSVGでのお絵描きを嗜み、
- 5月は英語の発音講義を受け、
- 6月はRustの言語仕様を改めて猛勉強し、
- 7月はWebGPUを触り始めた…

…といった具合で、一ヶ月ごとに違う分野の勉強に切り替えるというスタイル。無意識のうちにこうなっていた。

### 1月

正月休み、暇だったのでRustを勉強し始めた。

Rustを書き始めて一週間経った頃、まだまだ右も左も分からない状態でありながら、途方もない個人プロジェクトの構想を抱くようになった。

<LinkPreview id="https://tetracalibers.github.io/tomixyz-biography/ja/blog/2024-make-browser" />

### 2月

5月に迫るCodeGridパーティー。RemotionというReact製の動画制作ライブラリを使って、ひたすらテトリスムービーを制作していた。

<LinkPreview id="https://www.remotion.dev/" hideMedia />

プライベートでは、知人の依頼を受けてExcel関数の講師をやっていた。（Excel関数なんて触ったこともないのに…）

Excelに触れるごとに、リアクティブなセル状態の管理や再描画をどう実現しているのかが気になってしょうがなくなり、Excel風のスプレッドシートWebアプリのフルスクラッチ実装に闘志を燃やしていた時期もある。

…が、スクロール時再描画のパフォーマンス改善や、Excel関数パーサーの実装に嫌気が差してきた頃、handsontableというライブラリを見つけてしまった。もうこれ使えばいいじゃん…となってしまったのでスプレッドシートアプリ開発の情熱はそこまで続かず。

大人しくhandsontableを使って、ブラウザ上のインタラクティブなデモで実践練習ができるExcel関数学習サイトをひっそりと立ち上げたりしていた。

<LinkPreview id="https://tetracalibers.github.io/tomixyz-biography/ja/projects/pocket-excel-learning/" />

### 3月

地味すぎてあまり覚えていないが…

Real World HTTPの第3版がもうすぐ出版されるという情報を小耳に挟んで、その前にTCP/IPくらい思い出しておこう、と思い立ったのだろう。

そんなわけでひたすらネットワーク本を読み漁っていた記憶がある。

### 4月

去年の冬からずっと出版を心待ちにしていた、SVGによるジェネラティブアートの洋書がついに発売。

その本を読み終えた後、久しぶりにSVG Filterで遊びたくなり、水彩画風フィルターを作るなど、SVG Filterとは子供とおもちゃのように戯れていた。

### 5月

英語学習オタクになっていた時期。

プライベートでのちょっとした思い切りにより、外国の方と話す機会が増えるも、結局筆談でしか会話できず、目の前にいるのに言葉すら交わせない無力感を味わった。そんな不自由な状況を打破したいと思ったのがきっかけ。

始めた後のモチベーションは、threejs journeyの動画についていけるだけのリスニング力が欲しい、という点にあった。

また、6月に迫る社員旅行では、公用語が英語のリゾートに行くらしいという噂を聞いていたため、それまでに日常会話くらいは…と焦っていたのもある。

しかし、一ヶ月やそこらで劇的に変わるほど語学は甘いものでもなく、技術の勉強を差し置いてまで語学学習に膨大な時間を費やす覚悟をいつまでも持てなかった。そんなことより、コードが書きたくて…

### 6月

社員旅行から帰ってきた頃、「Rustで作るプログラミング言語」という本が刊行される。

Rustによるパーサー実装の指南書が登場したことは、1月に始めた途方もないプロジェクトの実装を検討し直し、もう一度本気で取り組む大きな契機となった。

とはいえRustの言語仕様をちゃんと理解せぬまま、これ以上コードを書くことにもどかしさも生まれて、「コンセプトで学ぶRust」という本を手に取った。

この本に出会えたのは運命的だったと思う。所有権とか、ライフタイムとか、RcとかBoxとかdynとか、コンパイルエラーのメッセージを頼りに適当に付け足していたもの…そんなRust特有の概念の理解だけでなく、CやJSなど元々馴染みのあったプログラミング言語の動作に対する解像度も上がった。

この本を読んだことで、ようやくRust bookの解説にもついていけるようになって、個人プロジェクトに関するリソースも読み進められるようになって、…

…そろそろ、その個人プロジェクトの話をしよう。7月の話をする前に。

## それでも情熱は集約されていた

脱線しまくりのこんな中でも、1月からずっと一貫して情熱を注いでいた個人プロジェクトがある。

それは、ブラウザのレンダリングエンジンをRustでフルスクラッチ実装するというもの。

そもそもRustに手を出した動機も、Servoのソースコードを読めるようになりたいという憧れがあってのものだった。（なぜC++を学び直してWebKitのソースコードを読む…という発想にならなかったのかは謎。あの頃から、どこかでRustという言語自体に漠然と惹かれていたのかもしれない。）

既存のブラウザを凌駕する新星ブラウザを世に出そう、とかそんな夢があるわけではなく、ただ単純に、私がブラウザの内部実装を探索したいだけだ。

だからこそ、フルスクラッチにこだわる。それがどんなに途方もなく、味気ない道のりだったとしても。

### 7月

7月が始まる頃には、ごく一部の機能にしか対応できていないとはいえ、DOM、HTML Parser、CSS Parser、style、layout、というレンダリングエンジンの主要コンポーネントは大まかに実装できていた。

ここから先は、paint計算をし、実際に何かに描画するフェーズが待っている。レンダリングエンジン開発の中で、もっともロマンある工程だ。

当初の予定では、レンダリング結果は画像に出力できればそれで十分だと思っていた。

でも、やっぱり…せっかくWebGL（OpenGL）やシェーダー言語に対する情熱も持ち合わせているのだから、ちゃんとウィンドウを立ち上げて、そこに描画する仕組みを作りたい。

RustにはさまざまなグラフィックスライブラリやGUIライブラリがあるが、基本プリミティブやUIコンポーネントが最初から用意されているライブラリは使いたくはない。もっと低レベルなライブラリを求めていた。

そしてwgpuというライブラリを見つけるまでに、そこまで時間はかからなかった。RustのGUIライブラリの多くが、wgpuを基礎としている。なによりも意義があると感じたのは、wgpuがWebGPU APIのRust実装であるという点だ。
まだ一部のブラウザでしか使えないWebGPUだが、来たるWebの未来に向けて…Rustを介して、今のうちにWebGPUのAPIに慣れ親しんでおくことは、『すべての寄り道をWebに還元する』というモットーにも沿っていて、十分に意味がある。

というわけで、7月下旬は、Learn Wgpuのサンプルを最新バージョンのwinitとwgpuで書き直したり、初めてのWebGPUアプリをRust移植したり。
プライベートの時間をほぼ丸ごと捧げたこの二週間で、WebGPUにもWGSLにもそれなりに馴染んできた。

## レンダリングというロマンを追い求めて

手段を手に入れると、それを使ってできそうなことが無数に見えてきて、やってみたいことが一気に増える。それが逆に、悩ましくもあった。
純粋にWebGPU自体が楽しくなってきた私は、なにかしら、WebGPUならではの実装を探求できるテーマに取り組みたいと強く思うようになる。

たとえば、一年前の開発合宿で作った、WebGL2とGLSLによる画像加工アプリ。
ステンドグラス風の画像加工フィルタは、実は未完成のままだ。距離変換を高速に実行する手法がどうしても思いつかなくて、結局ボロノイの適応的母点配置（エッジ付近に母点を増やす処理）は実現できぬまま終わっている。WebGPUならcompute shaderをうまいこと使えば実現できるんじゃないかとか、無知なりにいろいろな夢を膨らませていた。

もちろん、ブラウザ開発でも良いのだが、それならそれで簡易的なレンダリングエンジンで終わることなく、GPUによるレンダリングの最適化まで深く踏み込みたいと思うようになってしまったのだ。

### 8月

- テキストレンダリング
- 仕事では、技術以外のことで悩み始める

### GPUIの夢を見る

GPUIというプロジェクトに衝撃を受けた。

<LinkPreview id="https://zed.dev/blog/videogame" hideMedia />

GPUIは、Zedというテキストエディタのレンダリングのために開発されている2Dレンダリングエンジン。

### 思い知った途方のなさ

GPUIのコードを読んでいく中で、レンダリングエンジンの**フルスクラッチ**実装が、どこまで途方もないものかを思い知ることになる。

GPUIは、レイアウト計算をtaffyというライブラリに一任している。

### それでも、私は…

どこに進むとしても、そろそろ、実装したものを視覚的に確認できるようにしたい。まずは矩形を描画するところから始める。

その後の道は、UI描画のプロトタイプ実装と、レイアウトエンジンのプロトタイプ実装の二手に分かれる。

UI描画のプロトタイプでは、テキストレンダリングについて検証し、インタラクティブ要素やアニメーションを実現する仕組みを確立する。

レイアウトエンジンのプロトタイプでは、通常のフローレイアウトのアルゴリズムに加え、フレックスボックスレイアウトのアルゴリズム、グリッドレイアウトのアルゴリズムにも挑戦したい。

特に、グリッドレイアウトのロジックは、エビスコムさんの書籍に詳しく解説されているが、難解に感じている部分。アルゴリズムを自分で実装してみることで、ブラウザ内部でのレイアウト決定の理屈を踏まえてCSSを書けるようになるんじゃないかと期待している。

## さらに未来の話

私はやっぱりWebが好きだ。すべての寄り道は気まぐれでも新しい道の模索でもなく、結局はWeb技術への理解を深めて、Webに還元するためのものだと捉えている。

- threejs journeyとblender
- OpenCV
- WebGPUによるNPR再挑戦
- OS開発と非同期Rust
- ReactとVueとGoogle Mapを作る

## 大きな課題は分割しないと頓挫する？

2024年上半期、（寄り道しながらも）ずっとレンダリングエンジンの車輪の再発明という巨大なトピックに向き合ってきて、モチベーションを維持するのが正直大変な時期も多かった。

ゴールはとても遠く、先が見えない中で、実装を先に進めようと焦るあまり、ブログ執筆などの目立った言語化活動もできずにいた。

だが、「急いでゴールを目指す」ことがむしろ焦りを増長させているのではないかと、最近は思う。

多くのコードを書いていても、一向に自信を持てないのは、言語化できるほどの理解に落とし込む前にどんどん次のステップに進んでしまっているからなのかもしれない。

- 今後は日報を書くようにしたい？
